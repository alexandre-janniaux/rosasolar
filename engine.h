

#ifndef ENGINE_H
#define ENGINE_H

//#include "Arduino.h"
#include "Servo.h"

////////////////////////////////////////////////////////////
// Classe utilitaire pour controler le moteur
////////////////////////////////////////////////////////////
class Engine
{
public:
  ////////////////////////////////////////////////////////////
  // Mode de fonctionnement du moteur (en utilisant le relai)
  ////////////////////////////////////////////////////////////
  enum MODE {FORWARD, BACKWARD};

  ////////////////////////////////////////////////////////////
  // Prenitialisation du moteur (niveau software)
  // \param port : le pin arduino connecte au moteur
  ////////////////////////////////////////////////////////////
  void init( 
      int port,
      int m_Relay_pin
  );

  ////////////////////////////////////////////////////////////
  // 
  ////////////////////////////////////////////////////////////
  void wait ();

  ////////////////////////////////////////////////////////////
  // 
  ////////////////////////////////////////////////////////////
  void pulse (unsigned long pulse);

  ////////////////////////////////////////////////////////////
  // Sequence de demarrage du moteur (niveau hardware)
  ////////////////////////////////////////////////////////////
  void start ();

  ////////////////////////////////////////////////////////////
  // Defini une vitesse a atteindre
  // \param speed : la vitesse a atteindre
  ////////////////////////////////////////////////////////////
  void set_speed (
      int speed
  );

  ////////////////////////////////////////////////////////////
  // Donne la vitesse 
  // \return la vitesse actuelle
  ////////////////////////////////////////////////////////////
  int get_current_speed ();   

  ////////////////////////////////////////////////////////////
  // Met en marche le moteur et calcule la prochaine vitesse a atteindre
  ////////////////////////////////////////////////////////////
  void run ();
  
  ////////////////////////////////////////////////////////////
  // Change le mode de fonctionnement du moteur (pour avancer ou reculer)
  // \param mode : le mode de fonctionnement
  // \param locked : verrouiler ou non le mode (en cas d'utilisation manuelle)
  ////////////////////////////////////////////////////////////
  void set_mode (
      MODE mode,
      bool locked= false
  );
  
  
private:
  Servo m_Engine;
  int m_Port;
  int m_Relay_pin;
  int m_Speed;
  int m_CurrentSpeed;
  MODE m_Mode;
  bool m_LockedMode;
  
};
#endif

